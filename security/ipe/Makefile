# SPDX-License-Identifier: GPL-2.0
#
# Copyright (C) 2020-2024 Microsoft Corporation. All rights reserved.
#
# Makefile for building the IPE module as part of the kernel tree.
#

quiet_cmd_polgen = IPE_POL $(2)
      cmd_polgen = scripts/ipe/polgen/polgen security/ipe/boot-policy.c $(2)

targets += boot-policy.c

$(obj)/boot-policy.c: scripts/ipe/polgen/polgen $(CONFIG_IPE_BOOT_POLICY) FORCE
	$(call if_changed,polgen,$(CONFIG_IPE_BOOT_POLICY))

obj-$(CONFIG_SECURITY_IPE) += \
	boot-policy.o \
	digest.o \
	eval.o \
	hooks.o \
	fs.o \
	ipe.o \
	policy.o \
	policy_fs.o \
	policy_parser.o \
	audit.o \

obj-$(CONFIG_IPE_PROP_INTENDED_PATHNAME) += pathname.o
obj-$(CONFIG_IMA) += measure.o

clean-files := boot-policy.c \

obj-$(CONFIG_SECURITY_IPE_KUNIT_TEST) += \
	policy_tests.o \
